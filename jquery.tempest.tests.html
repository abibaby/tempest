<html>
    <body>

        <textarea class="tempest-template" id="template-message" style="display:none;">
            <li>%(name)% says "%(message)%"</li>
        </textarea>
        <textarea class="tempest-template" id="template-web-things" style="display:none;">
            <li>%(name)% is a %(type)% at %(url)%</li>
        </textarea>

        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
        <script type="text/javascript" src="jquery.tempest.js"></script>
        <script type="text/javascript">
        $(document).ready(function(){

            function testStorageFromTextarea(){
                var templ1 = $.tempest("template-message") == "<li>%(name)% says \"%(message)%\"</li>";
                var templ2 = $.tempest("template-web-things") == "<li>%(name)% is a %(type)% at %(url)%</li>";
                return templ1 == true && templ2 == true;
            }
            fireunit.ok(testStorageFromTextarea(), "Access stored templates that were inside textareas");

            function testSetTemplate(){
                var tmpl = "Hello %(variable)%";
                return $.tempest("hello", tmpl) == tmpl;
            }
            fireunit.ok(testSetTemplate(), "Template setter");

            function testGetTemplate(){
                var key = "arbitrary";
                var tmpl = "Hello %(variable)%";
                $.tempest(key, tmpl);
                return $.tempest(key) == tmpl;
            }
            fireunit.ok(testGetTemplate(), "Template getter");

            function testRenderedValue(){
                var obj = {"name":"my site", "type":"blog", "url":"http://fitzgeraldnick.com/"};
                var rendered = $.tempest("template-web-things", obj);
                return rendered.text() == "my site is a blog at http://fitzgeraldnick.com/";
            }
            fireunit.ok(testRenderedValue(), "The text of the rendered template is correct");

            function testAppendSingleObject(){
                var len = $("body ul li").length;
                var message = {name:"nick", message:"hello world"};
                var rendered = $.tempest("template-message", message);
                $("body ul").append(rendered);
                return len + 1 == $("body ul li").length;
            }
            fireunit.ok(testAppendSingleObject(), "Append a single rendered object to the DOM");

            function testManyRenderedValue(){
                var arr = [{name:"mom", message:"brush your teeth"},
                           {name:"heidi", message:"why hello"},
                           {name:"bill clinton", message:"I didn't inhale"},
                           {name:"OJ and Brittany", message:"Oops I did it again"},];
                var text = $.tempest("template-message", arr).text();

                var expected = [];
                for (i = 0; i < arr.length; i++){
                    expected.push($.tempest("template-message", arr[i]).text());
                }
                expected = expected.join("");
                return text == expected;
            }
            fireunit.ok(testManyRenderedValue(), "The text of the rendered template is correct");

            function testAppendManyObjects(){
                var len = $("body ul li").length;
                var arr = [{name:"mom", message:"brush your teeth"},
                           {name:"heidi", message:"why hello"},
                           {name:"bill clinton", message:"I didn't inhale"},
                           {name:"OJ and Brittany", message:"Oops I did it again"},];
                var rendered = $.tempest("template-message", arr);
                $("body ul").append(rendered);
                return len + arr.length == $("body ul li").length;
            }
            fireunit.ok(testAppendManyObjects(), "Append an array of rendered objects to the DOM");

            function testRenderOneTimeUseTemplate(){
                var obj = {thing:"test", activity:"TESTS"};
                var tmpl = "<li><em>Whoah a one time use %(thing)% for doing %(activity)%</em></li>";
                var rendered = $.tempest(tmpl, obj);
                return rendered.text() == "Whoah a one time use test for doing TESTS";
            }
            fireunit.ok(testRenderOneTimeUseTemplate(), "Render data to a one-time-use template");

            function testAppendOneTimeUseTemplate(){
                var len = $("body ul li").length;
                var obj = {thing:"test", activity:"TESTS"};
                var tmpl = "<li><em>Whoah a one time use %(thing)% for doing %(activity)%</em></li>";
                var rendered = $.tempest(tmpl, obj);
                $("body ul").append(rendered);
                return len + 1 == $("body ul li").length;
            }
            fireunit.ok(testAppendOneTimeUseTemplate(), "Append data from a rendered one-time-use template");

            function testUnknownInput(){
                try {
                    $.tempest(3242354534534);
                    return false;
                } catch(error) {
                    return error == "Unknown Input: jQuery.tempest can not handle the given arguments.";
                }
            }
            fireunit.ok(testUnknownInput(), "Unknown input throws an error");

            // evaluate all the tests
            fireunit.testDone();

            // see how long it takes to render 100 templates
            var start = new Date().getTime();
            for (i = 0; i < 100; i++) {
                var obj = {thing:"test"};
                var tmpl = "<li><em>Whoah a one time use %(thing)%!</em></li>";
                var rendered = $.tempest(tmpl, obj);
            }
            var end = new Date().getTime();
            var delta = (end - start) / 1000;
            alert("It took " + delta + " seconds to render 100 templates");


        });
        </script>

        <ul>
        </ul>
    </body>
</html>
